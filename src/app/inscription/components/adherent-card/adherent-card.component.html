<form *ngIf="formGroup && adherent" [formGroup]="formGroup" novalidate>
    <section class="inscription border-div">
        <div class="section-title name">
            <div class="left">
                <span class="title main">{{adherent.FirstName}} {{adherent.LastName}}</span>
                <br>
                <span class="title">{{category}}</span>
            </div>
            
            <div *ngIf="adherent.Photo" class="right">
                <img [src]="adherent.Photo" height="80">
            </div>
        </div>
        <mat-accordion>
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <mat-icon class="check" [ngClass]="adherent.Photo && !getLicenceError('licence') ? 'valid' : 'error'">check_circle</mat-icon>
                        <span class="title">Photo et Licence</span>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <!--  ================ Licence et Photo-->
                <div class="section-title adherent">
                    
                    <div class="name">
                        <div class="left"></div>
                        <div *ngIf="licenceRequired && adherent.Photo" class="right">
                            <img [src]="adherent.Photo" height="80" (click)="showEditPhoto()" title="Changer/Retoucher">
                        </div>
                    </div>

                    <div *ngIf="licenceRequired" class="licence">
                        <mat-form-field class="form-element row-item">
                            <input matInput [mask]="licenceInputMask" placeholder="N° de licence de l'an dernier"
                                formControlName="licence">
                            <mat-error
                                *ngIf="!formGroup.controls['licence'].valid && formGroup.controls['licence'].touched">
                                {{ getLicenceError('licence') }}
                            </mat-error>
                        </mat-form-field>
                        <div class="sub-info">(si renouvellement ou mutation)</div>
                    </div>

                    <div *ngIf="licenceRequired && editPhoto" class="take-photo">
                        <app-photo-taker [checked]="checked" [imageBase64]="adherent.Photo"
                            (photo)="onPhoto($event)"></app-photo-taker>
                    </div>

                </div>
            </mat-expansion-panel>

            <mat-expansion-panel *ngIf="checked.age <= 18">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <mat-icon class="check"
                            [ngClass]="adherent.Authorization ? 'valid' : 'error'">check_circle</mat-icon>
                        <span class="title">Autorisation parentale</span>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <!--  ================ Autorisation parentale -->
                <div class="section-title adherent">
                    <div class="parent-auth" (click)="showModalAuthParent()">
                        {{ adherent.Authorization ? '' : 'Une autorisation parentale est requise' }}

                    </div>
                </div>
            </mat-expansion-panel>

            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <mat-icon class="check" [ngClass]="adherent.HealthFile ? 'valid' : 'error'">check_circle</mat-icon>
                        <span class="title">Certificat médical / attestation de santé</span>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <!--  ================ Certificat médical ou attestation de santé -->
                <div class="section-title adherent">
                    <div class="check">
                        <div class="info">
                            <span class="accent">Certificat médical</span> de non contre-indication à la pratique du
                            sport ou de
                            la discipline concernée pour toute nouvelle adhésion ou tous les 3 ans, conformément aux
                            disposition
                            du code du sport et à la volonté fédérale de l'UNSLL
                            en matière de prévention de la santé du sportif.
                        </div>
                        <div *ngIf="!checked.certifNeeded" class="info">
                            <span class="accent">Ou Attestation de santé</span> entre chaque renouvellement triennal,
                            conformément au décret n°2016-1387 du 12/10/2016.
                        </div>

                        <mat-form-field>
                            <ngx-mat-file-input formControlName="file"
                                [placeholder]="!checked.certifNeeded ? 'Importer un certificat médical ou une attestation de santé' : 'Importer un certificat médical'"
                                (change)="onFileChange(formGroup.value)">
                            </ngx-mat-file-input>
                            <mat-icon matSuffix class="folder">folder</mat-icon>

                            <mat-error *ngIf="formGroup.get('file').hasError('maxContentSize')">
                                File size {{formGroup.get('file')?.getError('maxContentSize').maxSize | byteFormat}}
                                ({{formGroup.get('file').value.files[0].name | json}} g
                                {{formGroup.get('file')?.getError('maxContentSize').actualSize |
                                json
                                }} - {{formGroup.get('file')?.getError('maxContentSize').actualSize
                                | byteFormat}}).
                            </mat-error>
                        </mat-form-field>

                        <div *ngIf="adherent.HealthFile" class="selected-file">{{adherent.HealthFile}}</div>
                    </div>
                </div>
            </mat-expansion-panel>

            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <mat-icon class="check" [ngClass]="adherent.Rgpd && (checked.age > 18 ? adherent.Signature : true) ? 'valid' : 'error'">check_circle</mat-icon>
                        <span class="title">RGPD et Signature</span>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <!--  ================ RGPD et Signature -->
                <div class="section-title adherent">
                    <div class="section-title">
                        <span class="title">Utilisation de l'image personnelle</span>
                    </div>

                    <div class="check">
                        <div class="info">
                            J'accepte l’affichage, la diffusion de photos, vidéos, prises lors de manifestations ou
                            activités de
                            l'association,
                            auxquelles je participe ou un des membres de ma famille, ceci afin de figurer éventuellement
                            sur les
                            moyens de communication de l'association.
                        </div>

                        <mat-radio-group aria-labelledby="image-radio-group-label" class="image-radio-group"
                            [(ngModel)]="adherent.ImageRight" [ngModelOptions]="{standalone: true}">
                            <mat-radio-button class="image-radio-button" [value]="true">Oui</mat-radio-button>
                            <mat-radio-button class="image-radio-button" [value]="false">Non</mat-radio-button>
                        </mat-radio-group>
                    </div>
                    <div class="section-title">
                        <span class="title">Consentement des personnes</span>
                    </div>

                    <div class="check">
                        <div class="info">
                            Je reconnais avoir lu et j'accepte le Règlement Général européen sur la Protection des
                            Données
                            personnelles (R.G.P.D.)
                            disponible en suivant le lien <a href="https://leolagrangecolomiers.org/adherer/RGPD"
                                target="_blank">https://leolagrangecolomiers.org/adherer/RGPD</a>
                        </div>
                        <div class="info">
                            J'accepte que les informations saisies soient exploitées pour les finalités liées aux
                            activités du
                            CLLL et des sections.
                            Cet accord conditionne mon adhésion au <b>Club de Loisirs Léo Lagrange</b>.
                        </div>
                        <mat-checkbox formControlName="rgpd">J'accepte</mat-checkbox>
                        <mat-error *ngIf="!formGroup.controls['rgpd'].valid && formGroup.controls['rgpd'].touched">
                            {{ getCheckError('rgpd') }}
                        </mat-error>
                    </div>

                </div>
            </mat-expansion-panel>
        </mat-accordion>

    </section>
</form>